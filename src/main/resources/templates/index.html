<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>记账吧</title>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0,minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!--图标库-->
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css'>
    <!--响应式框架-->
    <link rel='stylesheet' href='../static/css/bootstrap.min.css'>
    <!--主要样式-->
    <link rel="stylesheet" href="../static/css/style.css">
    <link rel="stylesheet" href="../static/css/my.css">
    <link rel="stylesheet" href="../static/css/jcalculator.css">
    <link rel="stylesheet" href="../static/css/bootstrapValidator.css">
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../static/css/selectBox/index.css"/>
    <link rel="stylesheet" href="../static/css/selectBox/labelauty.css"/>
    <link rel="stylesheet" href="../static/css/footer.css"/>
    <script src="../static/js/jquery-2.1.0.js"></script>
    <script src="../static/js/layer-1.1.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="../static/js/moment-with-locales.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>

</head>

<body>

<div class="container">

    <div class="card-wrap">

        <div class="card border-0 shadow card--welcome is-show border-circular" id="welcome">
            <div class="card-body">
                <h2 class="card-title">欢迎进入记账吧</h2>
                <p>&nbsp;&nbsp;&nbsp;</p>
                <div class="userImage">
                    <a  href="/page/admin">
                        <img class="userImage" src="../static/img/catFace.png"></a>
                </div>
                <div class="btn-wrap">
                    <a class="btn btn-lg btn-register js-btn" data-target="register">花钱啦</a>
                    <a class="btn btn-lg btn-login js-btn" data-target="login">挣钱啦</a>
                </div>
            </div>
        </div>

        <div class="card border-0 shadow card--register" id="register">
            <div class="card-body">
                <h2 class="card-title">消费记录</h2>
                <p>&nbsp;&nbsp;&nbsp;</p>
                <form id="consumeForm" autocomplete="off">
                    <div class="form-group form-inline">
                        <div style="float: left">
                            <label>消费人:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
                        </div>
                        <div style="float: left">
                            <input type="radio" value="1" name="consumeBy" checked>&nbsp;可
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <input type="radio" value="2" name="consumeBy">&nbsp;欣
                        </div>
                    </div>
                    <!--消费类别下拉框-->
                    <div class="form-group form-inline">
                        <div style="float: left">
                            <label>消费类别:&nbsp;&nbsp;&nbsp;</label>
                        </div>
                        <div class="parent" style="width: 150px">
                            <button type="button" data-toggle="modal" id="selectedCategory"
                                    data-target="#consumeCategoryModal"
                                    style="text-align: left">请选择
                            </button>
                        </div>
                    </div>
                    <div class="form-group form-inline">
                        <div style="float: left">
                            <label>消费金额:&nbsp;&nbsp;&nbsp;</label>
                        </div>
                        <div style="float: left">
                            <input type="text" id="consumeAmount" readonly class="form-control"
                                   style="background-color: white;width: 150px;text-align:center"
                                   placeholder="金额"
                            />
                        </div>
                    </div>
                    <div class="form-group form-inline">
                        <div style="float: left">
                            <label>消费方式:&nbsp;&nbsp;&nbsp;</label>
                        </div>
                        <div style="float: left">
                            <input type="radio" value="1" name="consumeWay" checked>&nbsp;&nbsp;支付宝
                            <input type="radio" value="2" name="consumeWay">&nbsp;微信
                            <input type="radio" value="3" name="consumeWay">&nbsp;现金
                            <input type="radio" value="4" name="consumeWay">&nbsp;银行卡
                        </div>
                    </div>
                    <div class="form-group form-inline">
                        <div style="float: left">
                            <label>消费时间:&nbsp;&nbsp;&nbsp;</label>
                        </div>
                        <div style="float: left">
                            <div class='input-group date' id='consumeDatetimepicker' style="width: 150px;">
                                <input type='text' id="consumeDate" readonly class="form-control"
                                       style="background-color: white;"/>
                                <span class="input-group-addon">
                                <span class="glyphicon glyphicon-calendar"></span>
                             </span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group form-inline">
                        <div style="float: left">
                            <label>消费备注:&nbsp;&nbsp;&nbsp;</label>
                        </div>
                        <div class="form-group" style="width: 150px;">
                            <input class="form-control" type="text" id="consumeComment"
                                   style="width: 150px;text-align:center" placeholder="选填"/>
                        </div>
                    </div>

                    <button onclick="addConsumeDetail()" class="btn btn-lg">记一笔</button>
                </form>
            </div>
            <button class="btn btn-back js-btn" data-target="welcome"><i class="fas fa-angle-left"></i></button>
        </div>

        <div class="card border-0 shadow card--login" id="login">
            <div class="card-body">
                <h2 class="card-title">收入记录</h2>
                <p>&nbsp;&nbsp;&nbsp;</p>
                <form>
                    <div class="form-group form-inline">
                        <div style="float: left">
                            <label>收益人:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
                        </div>
                        <div style="float: left">
                            <input type="radio" value="1" name="incomeBy" checked>&nbsp;可
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <input type="radio" value="2" name="incomeBy">&nbsp;&nbsp;欣
                        </div>
                    </div>
                    <div class="form-group form-inline">
                        <div style="float: left">
                            <label>收益类别:&nbsp;&nbsp;&nbsp;</label>
                        </div>
                        <div style="float: left;">
                            <select class="form-control" id="incomeCategoryId" name="incomeCategoryId"
                                    style="width: 150px">
                                <option value="0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;请选择</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group form-inline">
                        <div style="float: left">
                            <label>收益金额:&nbsp;&nbsp;&nbsp;</label>
                        </div>
                        <div style="float: left">
                            <input type="number" id="incomeAmount" class="form-control" placeholder="金额"
                                   required="required" style="width: 150px;text-align:center"/>
                        </div>
                    </div>
                    <div class="form-group form-inline">
                        <div style="float: left">
                            <label>收益时间:&nbsp;&nbsp;&nbsp;</label>
                        </div>
                        <div style="float: left">
                            <div class='input-group date' id='incomeDatetimepicker' style="width: 150px;">
                                <input type='text' style="background-color: white;" id="incomeDate" readonly
                                       class="form-control"/>
                                <span class="input-group-addon">
                                    <span class="glyphicon glyphicon-calendar"></span>
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group form-inline">
                        <div style="float: left">
                            <label>收益备注:&nbsp;&nbsp;&nbsp;</label>
                        </div>
                        <div class="form-group" style="width: 150px;">
                            <input class="form-control" type="text" id="incomeComment"
                                   style="width: 150px;text-align:center" placeholder="选填"/>
                        </div>
                    </div>
                    <button onclick="addIncomeDetail()" class="btn btn-lg">记一笔</button>
                </form>
            </div>
            <button class="btn btn-back js-btn" data-target="welcome"><i
                    class="fas fa-angle-left"></i></button>
        </div>
    </div>
</div>

<!-- 模态框 -->
<div class="modal fade" id="consumeCategoryModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <!-- 模态框头部 -->
            <div class="modal-header" style="text-align: center">
                <h4 class="modal-title">消费类别</h4>
                <button type="button" id="closeModal" class="close" data-dismiss="modal">&times;</button>
            </div>
            <!-- 模态框主体 -->
            <div class="modal-body">
                <div id="consumeCategoryRadio" class="center"></div>
            </div>
        </div>
    </div>
</div>
</div>

<div class="footer fl-ar bg-black">
    <a>
        <img src="../static/img/icon/home_a_icon.png" alt="">
        <p class="blue-1">首页</p>
    </a>
    <a>
        <img src="../static/img/icon/equr_n_icon.png" alt="">
        <p>设备</p>
    </a>
    <a>
        <img src="../static/img/icon/mine_n_icon.png" alt="">
        <p>我的</p>
    </a>
</div>
<script src="../static/js/index.js"></script>
<script src="../static/js/jcalculator.js"></script>
<script src="../static/js/labelauty.js"></script>
<script src="../static/js/jump.js"></script>
</body>
</html>
<script type="text/javascript">
    $(function () {
        //计算器初始化
        $('#consumeAmount').calculator();

        $('#consumeDatetimepicker').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn'),
            ignoreReadonly: true
        });
        $('#incomeDatetimepicker').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn'),
            ignoreReadonly: true
        });
        initConsumeCategory();
        // initincomeCategory();
        $(".rdolist").labelauty("rdolist", "rdo");

        let now = new Date();
        let month = Number(now.getMonth()) + 1;
        let date = now.getDate();
        if (month < 10) {
            month = "0" + month
        }
        if (date < 10) {
            date = "0" + date
        }
        let nowDate = now.getFullYear() + "-" + month + "-" + date;
        $("#consumeDate").val(nowDate)
        $("#incomeDate").val(nowDate)

        $(".consumeCategoryDiv").on("click", function () {
            //关闭模态框
            $("#closeModal").click();
            const consumeCategoryName = $(".rdobox.checked").find(".radiobox-content").text();
            $("#selectedCategory").text(consumeCategoryName)
        })
    });

    //初始化消费类别
    function initConsumeCategory() {
        $.ajax({
            url: '/consume/category/getAll',
            type: 'get',
            cache: false,
            processData: false,
            async: true,
        }).done(function (res) {
            var categorys = res.data;
            for (var index in categorys) {
                var category = categorys[index]
                $("<div style='float: left;padding-left: 3px' class='consumeCategoryDiv'><input type='radio' value=" + category.id + " name='consumeCategoryId' class='rdolist'/>\n" +
                    "<label class='rdobox'>\n" +
                    "<span class='check-image'></span>\n" +
                    "<span class='radiobox-content'>" + category.categoryName + "</span>\n" +
                    " </label></div>")
                    .appendTo("#consumeCategoryRadio");
            }
        }).fail(function (res) {

        });
    }

    //初始化收益类别
    function initincomeCategory() {
        $.ajax({
            url: '/income/category/getAll',
            type: 'get',
            cache: false,
            processData: false,
            async: true
        }).done(function (res) {
            const categorys = res.data;
            for (const index in categorys) {
                const category = categorys[index];
                $("<option value=" + category.id + ">" + category.categoryName + "</option>").appendTo("#incomeCategoryId");
            }
        }).fail(function (res) {

        });
    }

    function addConsumeDetail() {
        const consumeAmount = $("#consumeAmount").val();
        const consumeCategoryId = $("input[name='consumeCategoryId']:checked").val();
        $.ajax({
            url: '/consume/detail/saveOrUpdate',
            type: 'POST',
            cache: false,
            data: JSON.stringify({
                "consumeCategoryId": consumeCategoryId,
                "consumeAmount": consumeAmount,
                "consumeWay": $("input[name='consumeWay']:checked").val(),
                "consumeDate": $("#consumeDate").val(),
                "consumeBy": $("input[name='consumeBy']:checked").val(),
                "consumeComment": $("#consumeComment").val()
            }),
            async: false,
            contentType: 'application/json',
            success: function (data) {
                layer.msg(data.message, {
                    time: 2800
                })
                window.location.href = "/page/index";
            },
            error: function (data) {
                layer.msg("记录失败!", {
                    time: 2800
                })
            }
        });
    }

    function addIncomeDetail() {
        $.ajax({
            url: '/income/detail/add',
            type: 'POST',
            cache: false,
            data: JSON.stringify({
                "incomeCategoryId": $("#incomeCategoryId").val(),
                "incomeAmount": $("#incomeAmount").val(),
                "incomeDate": $("#incomeDate").val(),
                "incomeBy": $("input[name='incomeBy']:checked").val(),
                "incomeComment": $("#incomeComment").val()
            }),
            async: false,
            contentType: 'application/json',
            success: function (data) {
                layer.msg(data.message, {
                    time: 2800
                })
                window.location.href = "/page/index";
            },
            error: function (data) {
                layer.msg("记录失败!", {
                    time: 2800
                })
            }
        });
    }
</script>